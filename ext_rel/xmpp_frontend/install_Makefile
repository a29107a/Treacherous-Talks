expat = expat-1.95.8

# TODO: remake this target if config files change.
install/: ejabberd $(expat) config
	cd $(expat) && ./configure --prefix=$(CURDIR)/installation
	cd $(expat) && make install
	cd ejabberd/src; if [ -e Makefile ]; then make clean; fi
	bash -x -c 'cd ejabberd/src && ./configure \
                                           --prefix=$(CURDIR)/installation \
                                           --with-expat=$(CURDIR)/installation'
	cd ejabberd/src && make install
	sed -i '2cexport LD_LIBRARY_PATH=$(CURDIR)/installation/lib' installation/sbin/ejabberdctl
	cp config/* installation/etc/ejabberd/

clean:
	rm -rf installation
