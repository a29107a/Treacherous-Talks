beams = components/echo_bot.beam components/controller.beam

all: install

reinstall: clean install

# TODO: remake this target if config files change.
install/: $(beams) install-ejabberd config
	cp config/* installation/etc/ejabberd/
	cp $(beams) installation/lib/ejabberd/ebin

install-ejabberd: installation/installed-ejabberd
installation/installed-ejabberd: ejabberd/src/made
	cd ejabberd/src && make install && (cd $(CURDIR) && touch installation/installed-ejabberd)

make-ejabberd: ejabberd/src/made
ejabberd/src/made:
	cd ejabberd/src && ./configure --prefix=$(CURDIR)/installation
	cd ejabberd/src && make && touch made

clean:
	cd ejabberd/src; if [ -e Makefile ]; then make clean; fi
	rm -rf installation
